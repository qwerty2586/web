{# twig template articles #}
<script type="text/javascript">
    var articles = [];
    var reviewers = [];
    $(function () {
        articles = JSON.parse('{{ articles | json_encode() | raw }}');
        reviewers = JSON.parse('{{ reviewers | json_encode() | raw }}');
    })
</script>
<div class="container">


    {% if (my_rights >= rights.user ) %}
        <a class="btn btn-primary" onclick="newArticle();"><span class="glyphicon glyphicon-plus-sign"
                                                                 aria-hidden="true"></span> New</a>
    {% endif %}
    <br/>
    <br/>
    <table class="table table-striped" id="article_table">
        <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>User</th>
            <th>Aprouved</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% set index = 0 %}
        {% for article in articles %}
            {% set index = index + 1 %}
            <tr>
                <td>
                    {{ index }}
                </td>
                <td>
                    {{ article.name }}
                </td>
                <td>
                    {{ article.username }}
                </td>
                <td>
                    {% if (article.aprouval == '0') %} Selecting reviewers {% endif %}
                    {% if (article.aprouval == '1') %} Reviewing {{ article.article_reviews | length }}/3 {% endif %}
                    {% if (article.aprouval == '2') %} Aprouved  {% endif %}
                </td>

                {# all  buttons#}
                <td>
                    <a class="btn btn-primary" href="/uploads/{{ article.filename }}" target="_blank" data-toggle="tooltip" title="Download"><span
                                class="glyphicon glyphicon-download"
                                aria-hidden="true"></span></a>
                    {% if my_rights >= rights.admin  %}
                        <a class="btn btn-danger" onclick="deleteArticle({{ index -1 }});" data-toggle="tooltip" title="Delete"><span
                                    class="glyphicon glyphicon-trash"
                                    aria-hidden="true"></span></a>
                    {% if (article.aprouval == '0') %}
                        <a class="btn btn-success" onclick="selectReviewersArticle({{ index -1 }});" data-toggle="tooltip" title="Select reviewers"><span
                                    class="glyphicon glyphicon-pencil"
                                    aria-hidden="true"></span></a>
                    {% endif %}
                    {% endif %}

                    {% if (article.aprouval == '1') %}
                        {% if article.my_review > 0 %}
                            <a class="btn btn-primary" onclick="writeReview({{ article.my_review }});" data-toggle="tooltip" title="Write Review"><span
                                        class="glyphicon glyphicon-pencil"
                                        aria-hidden="true"></span></a>
                        {% endif %}
                    {% endif %}


                </td>


            </tr>>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="article-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">New Article</h4>
            </div>
            <div class="modal-body">
                <label>Article Name</label>
                <input type='text' class='form-control' id='article-name'/><br/>

                <form method='post' action='' enctype="multipart/form-data" >
                    <label>File</label>
                    <input type='file' name='file' id='file' class='form-control' ><br>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="article-save">Save</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="reviewers-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Select Reviewers</h4>
            </div>
            <div class="modal-body">
                <label>Article Name</label>
                <input type='text' class='form-control' id='reviewers-name' readonly="readonly" /><br/>
                <label>Reviewer 1</label>
                <select class="form-control" id="user1"></select><br/>
                <label>Reviewer 2</label>
                <select class="form-control" id="user2"></select><br/>
                <label>Reviewer 3</label>
                <select class="form-control" id="user3"></select><br/>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="reviewers-save">Send to reviews</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="review-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Write review</h4>
            </div>
            <div class="modal-body">
                <label>Quality</label>
                <select class="form-control" id="review-quality">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select><br/>
                <label>Length</label>
                <select class="form-control" id="review-length">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select><br/>
                <label>Interesting</label>
                <select class="form-control" id="review-interesting">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select><br/>
                <label>Review</label>
                <textarea class="form-control" rows="3" id="review-review"></textarea>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="review-save">Send review</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<script>
    jQuery(function ($) {
        $('#article_table').DataTable({
            order: [1, 'desc'],
            columns: [
                null,
                null,
                null,
                null,
                {orderable: false}
            ]
        });
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>